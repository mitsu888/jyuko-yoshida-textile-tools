<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å…ˆæŸ“ã‚ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ V2 | è‰²ç»‡æ¨¡æ‹Ÿå™¨</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans SC", "Noto Sans JP", sans-serif; }
    .color-swatch { transition: transform 0.1s; }
    .color-swatch:hover { transform: scale(1.1); }
    .tooltip { position: relative; }
    .tooltip:hover::after {
      content: attr(data-tip);
      position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%);
      background: #1f2937; color: rgb(198, 85, 85); padding: 4px 8px; border-radius: 4px;
      font-size: 12px; white-space: nowrap; z-index: 50;
    }
    @media print { .no-print { display: none !important; } }
  </style>
</head>
<body class="bg-neutral-50 text-neutral-900 min-h-screen">

<div id="app" class="max-w-7xl mx-auto p-4"></div>

<script>
// ============================================================
// Pantoneãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆè¿‘ä¼¼è‰²ï¼‰
// ============================================================
const PANTONE_DB = [
  { code: '19-4052', name: 'Classic Blue', hex: '#0f4c81' },
  { code: '17-5104', name: 'Ultimate Gray', hex: '#939597' },
  { code: '13-0647', name: 'Illuminating', hex: '#f5df4d' },
  { code: '18-4548', name: 'Ibiza Blue', hex: '#2a6fa1' },
  { code: '17-1463', name: 'Tangerine Tango', hex: '#dd4124' },
  { code: '15-5519', name: 'Turquoise', hex: '#45b5aa' },
  { code: '18-3943', name: 'Blue Iris', hex: '#5a5b9f' },
  { code: '19-1664', name: 'True Red', hex: '#bf1932' },
  { code: '14-0756', name: 'Primrose Yellow', hex: '#f6d155' },
  { code: '15-1247', name: 'Apricot', hex: '#f5b895' },
  { code: '19-4024', name: 'Navy Blazer', hex: '#282d3c' },
  { code: '11-0601', name: 'Bright White', hex: '#f4f5f0' },
  { code: '19-0303', name: 'Jet Black', hex: '#2b2926' },
  { code: '17-1456', name: 'Tigerlily', hex: '#e2583e' },
  { code: '15-0343', name: 'Greenery', hex: '#88b04b' },
  { code: '18-1750', name: 'Viva Magenta', hex: '#be3455' },
  { code: '13-1023', name: 'Peach Fuzz', hex: '#ffbe98' },
  { code: '16-1546', name: 'Living Coral', hex: '#ff6f61' },
  { code: '19-4052', name: 'Classic Blue', hex: '#0f4c81' },
  { code: '18-3838', name: 'Ultra Violet', hex: '#5f4b8b' },
  { code: '15-1520', name: 'Rose Quartz', hex: '#f7cac9' },
  { code: '15-3919', name: 'Serenity', hex: '#92a8d1' },
  { code: '18-1438', name: 'Marsala', hex: '#955251' },
  { code: '17-5641', name: 'Emerald', hex: '#009473' },
  { code: '14-4811', name: 'Aqua Sky', hex: '#7bc4c4' },
];

// 2025å¹´ãƒˆãƒ¬ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼
const TREND_COLORS_2025 = {
  ss: [ // æ˜¥å¤
    { hex: '#ffbe98', name: { ja: 'ãƒ”ãƒ¼ãƒãƒ•ã‚¡ã‚º', zh: 'èœœæ¡ƒè‰²' }, pantone: '13-1023' },
    { hex: '#7bc4c4', name: { ja: 'ã‚¢ã‚¯ã‚¢ã‚¹ã‚«ã‚¤', zh: 'æ°´è“è‰²' }, pantone: '14-4811' },
    { hex: '#f5df4d', name: { ja: 'ã‚¤ãƒ«ãƒŸãƒã‚¤ãƒ†ã‚£ãƒ³ã‚°', zh: 'äº®é»„è‰²' }, pantone: '13-0647' },
    { hex: '#88b04b', name: { ja: 'ã‚°ãƒªãƒ¼ãƒŠãƒªãƒ¼', zh: 'è‰æœ¨ç»¿' }, pantone: '15-0343' },
    { hex: '#f7cac9', name: { ja: 'ãƒ­ãƒ¼ã‚ºã‚¯ã‚©ãƒ¼ãƒ„', zh: 'ç²‰æ™¶è‰²' }, pantone: '15-1520' },
    { hex: '#92a8d1', name: { ja: 'ã‚»ãƒ¬ãƒ‹ãƒ†ã‚£', zh: 'å®é™è“' }, pantone: '15-3919' },
  ],
  aw: [ // ç§‹å†¬
    { hex: '#955251', name: { ja: 'ãƒãƒ«ã‚µãƒ©', zh: 'ç›è¨æ‹‰é…’çº¢' }, pantone: '18-1438' },
    { hex: '#5f4b8b', name: { ja: 'ã‚¦ãƒ«ãƒˆãƒ©ãƒã‚¤ã‚ªãƒ¬ãƒƒãƒˆ', zh: 'ç´«å¤–å…‰è‰²' }, pantone: '18-3838' },
    { hex: '#009473', name: { ja: 'ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰', zh: 'ç¥–æ¯ç»¿' }, pantone: '17-5641' },
    { hex: '#282d3c', name: { ja: 'ãƒã‚¤ãƒ“ãƒ¼ãƒ–ãƒ¬ã‚¶ãƒ¼', zh: 'æµ·å†›è“' }, pantone: '19-4024' },
    { hex: '#be3455', name: { ja: 'ãƒ“ãƒãƒã‚¼ãƒ³ã‚¿', zh: 'éå‡¡æ´‹çº¢' }, pantone: '18-1750' },
    { hex: '#939597', name: { ja: 'ã‚¢ãƒ«ãƒ†ã‚£ãƒ¡ãƒƒãƒˆã‚°ãƒ¬ãƒ¼', zh: 'æè‡´ç°' }, pantone: '17-5104' },
  ]
};

// ============================================================
// ç”¨èªè¾å…¸
// ============================================================
const GLOSSARY = {
  ja: {
    'çµŒç³¸': 'ç¹”æ©Ÿã«ç¸¦æ–¹å‘ã«å¼µã‚‰ã‚Œã‚‹ç³¸ã€‚è‹±èªã§ã¯Warpã€‚å¯†åº¦ã¯EPIï¼ˆ1ã‚¤ãƒ³ãƒã‚ãŸã‚Šã®æœ¬æ•°ï¼‰ã§è¡¨ã™ã€‚',
    'ç·¯ç³¸': 'ç¹”æ©Ÿã§å·¦å³ã«æ‰“ã¡è¾¼ã¾ã‚Œã‚‹ç³¸ã€‚è‹±èªã§ã¯Weft/Fillingã€‚å¯†åº¦ã¯PPIï¼ˆ1ã‚¤ãƒ³ãƒã‚ãŸã‚Šã®æœ¬æ•°ï¼‰ã§è¡¨ã™ã€‚',
    'å¹³ç¹”': 'çµŒç³¸ã¨ç·¯ç³¸ãŒ1æœ¬ãšã¤äº¤äº’ã«äº¤å·®ã™ã‚‹æœ€ã‚‚åŸºæœ¬çš„ãªç¹”ã‚Šæ–¹ã€‚ä¸ˆå¤«ã§é€šæ°—æ€§ãŒè‰¯ã„ã€‚',
    'ç¶¾ç¹”': 'çµŒç³¸ã¾ãŸã¯ç·¯ç³¸ãŒ2æœ¬ä»¥ä¸Šé€£ç¶šã—ã¦æµ®ãç¹”ã‚Šæ–¹ã€‚æ–œã‚ã®ç•ï¼ˆãƒ„ã‚¤ãƒ«ï¼‰ãŒç‰¹å¾´ã€‚',
    'æœ±å­ç¹”': 'çµŒç³¸ã¾ãŸã¯ç·¯ç³¸ãŒé•·ãæµ®ã„ã¦å…‰æ²¢ã‚’å‡ºã™ç¹”ã‚Šæ–¹ã€‚ã‚µãƒ†ãƒ³ã¨ã‚‚å‘¼ã°ã‚Œã‚‹ã€‚',
    'EPI': 'Ends Per Inchã€‚1ã‚¤ãƒ³ãƒã‚ãŸã‚Šã®çµŒç³¸æœ¬æ•°ã€‚æ•°å€¤ãŒå¤§ãã„ã»ã©é«˜å¯†åº¦ã€‚',
    'PPI': 'Picks Per Inchã€‚1ã‚¤ãƒ³ãƒã‚ãŸã‚Šã®ç·¯ç³¸æœ¬æ•°ã€‚æ•°å€¤ãŒå¤§ãã„ã»ã©é«˜å¯†åº¦ã€‚',
    'GSM': 'Grams per Square Meterã€‚1å¹³æ–¹ãƒ¡ãƒ¼ãƒˆãƒ«ã‚ãŸã‚Šã®ã‚°ãƒ©ãƒ æ•°ã€‚ç”Ÿåœ°ã®åšã•ãƒ»é‡ã•ã®æŒ‡æ¨™ã€‚',
    'ç•ªæ‰‹': 'ç³¸ã®å¤ªã•ã‚’è¡¨ã™å˜ä½ã€‚ç¶¿ã¯Neï¼ˆè‹±å¼ç•ªæ‰‹ï¼‰ã€æ¯›ã¯Nmï¼ˆãƒ¡ãƒ¼ãƒˆãƒ«ç•ªæ‰‹ï¼‰ã‚’ä½¿ç”¨ã€‚æ•°å€¤ãŒå¤§ãã„ã»ã©ç´°ã„ã€‚',
    'ã‚³ãƒ¼ãƒç³¸': 'çŸ­ç¹Šç¶­ã‚’é™¤å»ã—ãŸé«˜å“è³ªãªç³¸ã€‚æ¯›ç¾½ãŒå°‘ãªãå…‰æ²¢ãŒã‚ã‚‹ã€‚',
    'ã‚«ãƒ¼ãƒ‰ç³¸': 'æ¨™æº–çš„ãªç´¡ç¸¾æ–¹æ³•ã§ä½œã‚‰ã‚ŒãŸç³¸ã€‚ã‚³ãƒ¼ãƒç³¸ã‚ˆã‚Šå®‰ä¾¡ã€‚',
    'ãƒãƒ¼ã‚»ãƒ©ã‚¤ã‚º': 'ã‚¢ãƒ«ã‚«ãƒªå‡¦ç†ã§ç¶¿ã«å…‰æ²¢ã¨å¼·åº¦ã‚’ä¸ãˆã‚‹åŠ å·¥ã€‚ã‚·ãƒ«ã‚±ãƒƒãƒˆåŠ å·¥ã¨ã‚‚ã€‚',
    'ãƒ‡ãƒ‹ãƒ¼ãƒ«': '9000ãƒ¡ãƒ¼ãƒˆãƒ«ã‚ãŸã‚Šã®ã‚°ãƒ©ãƒ æ•°ã€‚ãƒ•ã‚£ãƒ©ãƒ¡ãƒ³ãƒˆç³¸ã®å¤ªã•ã®å˜ä½ã€‚æ•°å€¤ãŒå¤§ãã„ã»ã©å¤ªã„ã€‚',
  },
  zh: {
    'ç»çº±': 'ç»‡æœºä¸Šçºµå‘å¼ ç´§çš„çº±çº¿ï¼Œè‹±æ–‡ä¸ºWarpã€‚å¯†åº¦ç”¨EPIï¼ˆæ¯è‹±å¯¸æ ¹æ•°ï¼‰è¡¨ç¤ºã€‚',
    'çº¬çº±': 'ç»‡æœºä¸Šæ¨ªå‘æ‰“å…¥çš„çº±çº¿ï¼Œè‹±æ–‡ä¸ºWeftã€‚å¯†åº¦ç”¨PPIï¼ˆæ¯è‹±å¯¸æ ¹æ•°ï¼‰è¡¨ç¤ºã€‚',
    'å¹³çº¹': 'ç»çº¬çº±ä¸€ä¸Šä¸€ä¸‹äº¤æ›¿äº¤ç»‡çš„æœ€åŸºæœ¬ç»‡æ³•ï¼Œç»“å®é€æ°”ã€‚',
    'æ–œçº¹': 'ç»çº±æˆ–çº¬çº±è¿ç»­æµ®èµ·2æ ¹ä»¥ä¸Šçš„ç»‡æ³•ï¼Œè¡¨é¢å‘ˆæ–œå‘çº¹è·¯ã€‚',
    'ç¼çº¹': 'ç»çº±æˆ–çº¬çº±é•¿æµ®çº¿å½¢æˆå…‰æ³½çš„ç»‡æ³•ï¼Œä¹Ÿå«è‰²ä¸ã€‚',
    'EPI': 'Ends Per Inchï¼Œæ¯è‹±å¯¸ç»çº±æ ¹æ•°ï¼Œæ•°å€¼è¶Šå¤§å¯†åº¦è¶Šé«˜ã€‚',
    'PPI': 'Picks Per Inchï¼Œæ¯è‹±å¯¸çº¬çº±æ ¹æ•°ï¼Œæ•°å€¼è¶Šå¤§å¯†åº¦è¶Šé«˜ã€‚',
    'GSM': 'Grams per Square Meterï¼Œæ¯å¹³æ–¹ç±³å…‹é‡ï¼Œè¡¨ç¤ºé¢æ–™åšåº¦å’Œé‡é‡ã€‚',
    'æ”¯æ•°': 'è¡¨ç¤ºçº±çº¿ç²—ç»†çš„å•ä½ï¼Œæ£‰ç”¨è‹±æ”¯Neï¼Œæ¯›ç”¨å…¬æ”¯Nmã€‚æ•°å€¼è¶Šå¤§è¶Šç»†ã€‚',
    'ç²¾æ¢³çº±': 'å»é™¤çŸ­çº¤ç»´çš„é«˜å“è´¨çº±çº¿ï¼Œæ¯›ç¾½å°‘æœ‰å…‰æ³½ã€‚',
    'æ™®æ¢³çº±': 'æ ‡å‡†çººçº±æ–¹æ³•ç”Ÿäº§çš„çº±çº¿ï¼Œæ¯”ç²¾æ¢³çº±ä¾¿å®œã€‚',
    'ä¸å…‰å¤„ç†': 'ç¢±å¤„ç†ä½¿æ£‰çº¤ç»´è·å¾—å…‰æ³½å’Œå¼ºåº¦çš„åŠ å·¥ã€‚',
    'æ—¦å°¼å°”': '9000ç±³é•¿åº¦çš„å…‹é‡ï¼Œé•¿ä¸çº±ç²—ç»†å•ä½ï¼Œæ•°å€¼è¶Šå¤§è¶Šç²—ã€‚',
  }
};

// ============================================================
// é¡ä¼¼ç”Ÿåœ°ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
// ============================================================
const SIMILAR_FABRICS = [
  { name: { ja: 'ã‚ªãƒƒã‚¯ã‚¹ãƒ•ã‚©ãƒ¼ãƒ‰ã‚·ãƒ£ãƒ„åœ°', zh: 'ç‰›æ´¥è¡¬è¡«å¸ƒ' }, weave: 'oxford', yarn: 'cotton', epiRange: [80, 120], gsmRange: [120, 180] },
  { name: { ja: 'ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚¯ãƒ­ã‚¹', zh: 'åºœç»¸' }, weave: 'plain', yarn: 'cotton', epiRange: [100, 140], gsmRange: [100, 150] },
  { name: { ja: 'ãƒ‡ãƒ‹ãƒ  12oz', zh: '12ç›å¸ç‰›ä»”å¸ƒ' }, weave: 'denim', yarn: 'cotton', epiRange: [60, 80], gsmRange: [350, 420] },
  { name: { ja: 'ãƒ‡ãƒ‹ãƒ  8oz', zh: '8ç›å¸ç‰›ä»”å¸ƒ' }, weave: 'denim', yarn: 'cotton', epiRange: [70, 90], gsmRange: [250, 300] },
  { name: { ja: 'ã‚®ãƒ£ãƒã‚¸ãƒ³', zh: 'åè¾¾å‘¢' }, weave: 'gabardine', yarn: 'wool', epiRange: [80, 120], gsmRange: [200, 280] },
  { name: { ja: 'ã‚µãƒ†ãƒ³', zh: 'è‰²ä¸' }, weave: 'satin_5', yarn: 'silk', epiRange: [150, 200], gsmRange: [80, 150] },
  { name: { ja: 'ãƒãƒ­ãƒ”ã‚±', zh: 'ç åœ°Poloå¸ƒ' }, weave: 'pique', yarn: 'cotton', epiRange: [60, 80], gsmRange: [180, 220] },
  { name: { ja: 'ãƒ„ã‚¤ãƒ«ãƒãƒ', zh: 'æ–œçº¹å¡å…¶å¸ƒ' }, weave: 'twill_2_1', yarn: 'cotton', epiRange: [100, 130], gsmRange: [200, 280] },
  { name: { ja: 'ãƒ˜ãƒªãƒ³ãƒœãƒ¼ãƒ³ã‚¸ãƒ£ã‚±ãƒƒãƒˆåœ°', zh: 'äººå­—çº¹å¤¹å…‹å¸ƒ' }, weave: 'herringbone', yarn: 'wool', epiRange: [70, 100], gsmRange: [250, 350] },
  { name: { ja: 'ã‚·ã‚¢ã‚µãƒƒã‚«ãƒ¼', zh: 'æ³¡æ³¡çº±' }, weave: 'seersucker', yarn: 'cotton', epiRange: [80, 100], gsmRange: [100, 150] },
];

// ============================================================
// å¤šè¨€èªå¯¾å¿œãƒ†ã‚­ã‚¹ãƒˆ
// ============================================================
const LANG = {
  ja: {
    title: 'å…ˆæŸ“ã‚ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼',
    subtitle: 'ç¹”ã‚Šçµ„ç¹” Ã— ç³¸ Ã— è‰²ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼',
    tabs: { design: 'ãƒ‡ã‚¶ã‚¤ãƒ³', weave: 'ç¹”ã‚Šçµ„ç¹”', yarn: 'ç³¸é¸æŠ', specs: 'è¦æ ¼', tools: 'ãƒ„ãƒ¼ãƒ«' },
    pattern: 'ãƒ‘ã‚¿ãƒ¼ãƒ³',
    patterns: { check: 'ãƒã‚§ãƒƒã‚¯', stripe: 'ã‚¹ãƒˆãƒ©ã‚¤ãƒ—', solid: 'ç„¡åœ°' },
    warpColor: 'çµŒç³¸ã®è‰²',
    weftColor: 'ç·¯ç³¸ã®è‰²',
    pitch: 'æŸ„ãƒ”ãƒƒãƒ',
    zoom: 'ã‚ºãƒ¼ãƒ ',
    weaveCategory: 'ç¹”ã‚Šã‚«ãƒ†ã‚´ãƒª',
    selectWeave: 'ç¹”ã‚Šçµ„ç¹”ã‚’é¸æŠ',
    yarnCategory: 'ç´ æã‚«ãƒ†ã‚´ãƒª',
    warpYarn: 'çµŒç³¸',
    weftYarn: 'ç·¯ç³¸',
    epi: 'çµŒç³¸å¯†åº¦ (EPI)',
    ppi: 'ç·¯ç³¸å¯†åº¦ (PPI)',
    gsm: 'ç›®ä»˜',
    fabricSummary: 'ç”Ÿåœ°æ§‹æˆã‚µãƒãƒªãƒ¼',
    weaveType: 'ç¹”ã‚Šçµ„ç¹”',
    difficulty: 'é›£æ˜“åº¦',
    savePng: 'PNGä¿å­˜',
    riskAnalysis: 'ãƒªã‚¹ã‚¯åˆ†æ',
    risks: 'ä»¶ã®ãƒªã‚¹ã‚¯',
    sellingPoints: 'è¨´æ±‚ãƒã‚¤ãƒ³ãƒˆ',
    preview: 'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼',
    quickColors: 'ã‚¯ã‚¤ãƒƒã‚¯ã‚«ãƒ©ãƒ¼',
    noRisk: 'ãƒªã‚¹ã‚¯ãªã—',
    specSheet: 'ä»•æ§˜æ›¸å‡ºåŠ›',
    compare: 'æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰',
    glossary: 'ç”¨èªè¾å…¸',
    pantone: 'Pantoneå¤‰æ›',
    season: 'å­£ç¯€åˆ¤å®š',
    similar: 'é¡ä¼¼ç”Ÿåœ°',
    trend: 'ãƒˆãƒ¬ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼',
    random: 'ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆ',
    springSum: 'æ˜¥å¤å‘ã',
    autumnWin: 'ç§‹å†¬å‘ã',
    allSeason: 'ã‚ªãƒ¼ãƒ«ã‚·ãƒ¼ã‚ºãƒ³',
    characteristics: {
      durability: 'è€ä¹…', drape: 'ãƒ‰ãƒ¬ãƒ¼ãƒ—', breathability: 'é€šæ°—',
      wrinkleResistance: 'é˜²ã‚·ãƒ¯', shine: 'å…‰æ²¢', strength: 'å¼·åº¦',
      softness: 'æŸ”ã‚‰ã‹ã•', luster: 'å…‰æ²¢', elasticity: 'å¼¾åŠ›', absorbency: 'å¸æ¹¿'
    },
    weaveCategories: {
      plain: 'å¹³ç¹”ç³»', twill: 'ç¶¾ç¹”ç³»', satin: 'æœ±å­ç¹”ç³»',
      dobby: 'ãƒ‰ãƒ“ãƒ¼', jacquard: 'ã‚¸ãƒ£ã‚«ãƒ¼ãƒ‰', pile: 'ãƒ‘ã‚¤ãƒ«', special: 'ç‰¹æ®Šç¹”'
    },
    fiberCategories: {
      cotton: 'ç¶¿', linen: 'éº»', wool: 'ç¾Šæ¯›', silk: 'çµ¹',
      synthetic: 'åˆæˆ', regenerated: 'å†ç”Ÿ', blend: 'æ··ç´¡', specialty: 'ç‰¹æ®Š'
    },
    fibers: {
      cotton: 'ç¶¿', polyester: 'ãƒãƒªã‚¨ã‚¹ãƒ†ãƒ«', wool: 'ã‚¦ãƒ¼ãƒ«', linen: 'éº»',
      silk: 'ã‚·ãƒ«ã‚¯', nylon: 'ãƒŠã‚¤ãƒ­ãƒ³', viscose: 'ãƒ¬ãƒ¼ãƒ¨ãƒ³', spandex: 'ã‚¹ãƒ‘ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹',
      modal: 'ãƒ¢ãƒ€ãƒ¼ãƒ«', lyocell: 'ãƒ†ãƒ³ã‚»ãƒ«', cashmere: 'ã‚«ã‚·ãƒŸãƒ¤', acrylic: 'ã‚¢ã‚¯ãƒªãƒ«'
    },
    riskLevels: { none: 'ãªã—', low: 'ä½', medium: 'ä¸­', high: 'é«˜', critical: 'è¦æ³¨æ„' },
    weightCat: { ultraLight: 'æ¥µè–„åœ°', light: 'è–„åœ°', mediumLight: 'ä¸­è–„åœ°', medium: 'ä¸­åšåœ°', heavy: 'åšåœ°', ultraHeavy: 'æ¥µåšåœ°' },
    close: 'é–‰ã˜ã‚‹', download: 'ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰', print: 'å°åˆ·',
    fabricA: 'ç”Ÿåœ°A', fabricB: 'ç”Ÿåœ°B', current: 'ç¾åœ¨ã®è¨­å®š',
    nearestPantone: 'è¿‘ä¼¼Pantone',
  },
  zh: {
    title: 'è‰²ç»‡æ¨¡æ‹Ÿå™¨',
    subtitle: 'ç»‡ç‰©ç»„ç»‡ Ã— çº±çº¿ Ã— é¢œè‰²çš„å®æ—¶é¢„è§ˆ',
    tabs: { design: 'è®¾è®¡', weave: 'ç»„ç»‡', yarn: 'çº±çº¿', specs: 'è§„æ ¼', tools: 'å·¥å…·' },
    pattern: 'å›¾æ¡ˆ',
    patterns: { check: 'æ ¼å­', stripe: 'æ¡çº¹', solid: 'ç´ è‰²' },
    warpColor: 'ç»çº±é¢œè‰²',
    weftColor: 'çº¬çº±é¢œè‰²',
    pitch: 'èŠ±çº¹é—´è·',
    zoom: 'ç¼©æ”¾',
    weaveCategory: 'ç»‡ç‰©ç±»åˆ«',
    selectWeave: 'é€‰æ‹©ç»‡ç‰©ç»„ç»‡',
    yarnCategory: 'æè´¨ç±»åˆ«',
    warpYarn: 'ç»çº±',
    weftYarn: 'çº¬çº±',
    epi: 'ç»å¯† (EPI)',
    ppi: 'çº¬å¯† (PPI)',
    gsm: 'å…‹é‡',
    fabricSummary: 'é¢æ–™æ„æˆæ‘˜è¦',
    weaveType: 'ç»‡ç‰©ç»„ç»‡',
    difficulty: 'éš¾åº¦',
    savePng: 'ä¿å­˜PNG',
    riskAnalysis: 'é£é™©åˆ†æ',
    risks: 'é¡¹é£é™©',
    sellingPoints: 'å–ç‚¹',
    preview: 'é¢„è§ˆ',
    quickColors: 'å¿«é€Ÿé€‰è‰²',
    noRisk: 'æ— é£é™©',
    specSheet: 'è§„æ ¼ä¹¦è¾“å‡º',
    compare: 'å¯¹æ¯”æ¨¡å¼',
    glossary: 'æœ¯è¯­è¯å…¸',
    pantone: 'Pantoneè½¬æ¢',
    season: 'å­£èŠ‚åˆ¤å®š',
    similar: 'ç±»ä¼¼é¢æ–™',
    trend: 'è¶‹åŠ¿è‰²',
    random: 'éšæœºç”Ÿæˆ',
    springSum: 'æ˜¥å¤é€‚ç”¨',
    autumnWin: 'ç§‹å†¬é€‚ç”¨',
    allSeason: 'å››å­£é€‚ç”¨',
    characteristics: {
      durability: 'è€ä¹…', drape: 'å‚æ„Ÿ', breathability: 'é€æ°”',
      wrinkleResistance: 'æŠ—çš±', shine: 'å…‰æ³½', strength: 'å¼ºåº¦',
      softness: 'æŸ”è½¯', luster: 'å…‰æ³½', elasticity: 'å¼¹æ€§', absorbency: 'å¸æ¹¿'
    },
    weaveCategories: {
      plain: 'å¹³çº¹', twill: 'æ–œçº¹', satin: 'ç¼çº¹',
      dobby: 'å¤šè‡‚', jacquard: 'æèŠ±', pile: 'æ¯›åœˆ', special: 'ç‰¹æ®Š'
    },
    fiberCategories: {
      cotton: 'æ£‰', linen: 'éº»', wool: 'æ¯›', silk: 'ä¸',
      synthetic: 'åˆçº¤', regenerated: 'å†ç”Ÿ', blend: 'æ··çºº', specialty: 'ç‰¹ç§'
    },
    fibers: {
      cotton: 'æ£‰', polyester: 'æ¶¤çº¶', wool: 'ç¾Šæ¯›', linen: 'éº»',
      silk: 'ä¸ç»¸', nylon: 'å°¼é¾™', viscose: 'ç²˜èƒ¶', spandex: 'æ°¨çº¶',
      modal: 'è«ä»£å°”', lyocell: 'å¤©ä¸', cashmere: 'ç¾Šç»’', acrylic: 'è…ˆçº¶'
    },
    riskLevels: { none: 'æ— ', low: 'ä½', medium: 'ä¸­', high: 'é«˜', critical: 'éœ€æ³¨æ„' },
    weightCat: { ultraLight: 'æè–„', light: 'è–„å‹', mediumLight: 'ä¸­è–„', medium: 'ä¸­åš', heavy: 'åšå‹', ultraHeavy: 'æåš' },
    close: 'å…³é—­', download: 'ä¸‹è½½', print: 'æ‰“å°',
    fabricA: 'é¢æ–™A', fabricB: 'é¢æ–™B', current: 'å½“å‰è®¾ç½®',
    nearestPantone: 'è¿‘ä¼¼Pantone',
  }
};

// ============================================================
// ç¹”ã‚Šçµ„ç¹”ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆç°¡ç•¥ç‰ˆï¼‰
// ============================================================
function createMatrix(rows, cols, fn) {
  const m = [];
  for (let y = 0; y < rows; y++) { const r = []; for (let x = 0; x < cols; x++) r.push(fn(x, y)); m.push(r); }
  return m;
}

const WEAVE_DB = [
  { id: 'plain', name: { ja: 'å¹³ç¹”', zh: 'å¹³çº¹' }, cat: 'plain', matrix: createMatrix(2, 2, (x, y) => (x+y)%2===0), rx: 2, ry: 2, chars: { durability: 5, drape: 2, breathability: 5, wrinkleResistance: 2, shine: 1 }, gsm: 1.0, diff: 1, apps: { ja: ['ã‚·ãƒ£ãƒ„'], zh: ['è¡¬è¡«'] } },
  { id: 'oxford', name: { ja: 'ã‚ªãƒƒã‚¯ã‚¹ãƒ•ã‚©ãƒ¼ãƒ‰', zh: 'ç‰›æ´¥å¸ƒ' }, cat: 'plain', matrix: createMatrix(4, 4, (x, y) => { const px=Math.floor(x/2), py=Math.floor(y/2); return (px+py)%2===0; }), rx: 4, ry: 4, chars: { durability: 4, drape: 3, breathability: 4, wrinkleResistance: 3, shine: 2 }, gsm: 1.15, diff: 2, apps: { ja: ['ã‚·ãƒ£ãƒ„'], zh: ['è¡¬è¡«'] } },
  { id: 'broadcloth', name: { ja: 'ãƒ–ãƒ­ãƒ¼ãƒ‰', zh: 'åºœç»¸' }, cat: 'plain', matrix: createMatrix(2, 2, (x, y) => (x+y)%2===0), rx: 2, ry: 2, chars: { durability: 4, drape: 3, breathability: 4, wrinkleResistance: 3, shine: 3 }, gsm: 0.95, diff: 2, apps: { ja: ['ãƒ‰ãƒ¬ã‚¹ã‚·ãƒ£ãƒ„'], zh: ['æ­£è£…è¡¬è¡«'] } },
  { id: 'canvas', name: { ja: 'å¸†å¸ƒ', zh: 'å¸†å¸ƒ' }, cat: 'plain', matrix: createMatrix(2, 2, (x, y) => (x+y)%2===0), rx: 2, ry: 2, chars: { durability: 5, drape: 1, breathability: 3, wrinkleResistance: 4, shine: 1 }, gsm: 2.0, diff: 2, apps: { ja: ['ãƒãƒƒã‚°'], zh: ['åŒ…'] } },
  { id: 'twill_2_1', name: { ja: '2/1ãƒ„ã‚¤ãƒ«', zh: '2/1æ–œçº¹' }, cat: 'twill', matrix: createMatrix(3, 3, (x, y) => (x+y)%3<2), rx: 3, ry: 3, chars: { durability: 4, drape: 4, breathability: 3, wrinkleResistance: 3, shine: 3 }, gsm: 1.05, diff: 2, apps: { ja: ['ãƒãƒ'], zh: ['å¡å…¶è£¤'] } },
  { id: 'twill_2_2', name: { ja: '2/2ãƒ„ã‚¤ãƒ«', zh: '2/2æ–œçº¹' }, cat: 'twill', matrix: createMatrix(4, 4, (x, y) => (x+y)%4<2), rx: 4, ry: 4, chars: { durability: 4, drape: 4, breathability: 3, wrinkleResistance: 4, shine: 3 }, gsm: 1.1, diff: 2, apps: { ja: ['ã‚¹ãƒ¼ãƒ„'], zh: ['è¥¿è£…'] } },
  { id: 'denim', name: { ja: 'ãƒ‡ãƒ‹ãƒ ', zh: 'ç‰›ä»”å¸ƒ' }, cat: 'twill', matrix: createMatrix(4, 4, (x, y) => (x-y+4)%4<3), rx: 4, ry: 4, chars: { durability: 5, drape: 2, breathability: 3, wrinkleResistance: 3, shine: 2 }, gsm: 1.4, diff: 2, apps: { ja: ['ã‚¸ãƒ¼ãƒ³ã‚º'], zh: ['ç‰›ä»”è£¤'] } },
  { id: 'herringbone', name: { ja: 'ãƒ˜ãƒªãƒ³ãƒœãƒ¼ãƒ³', zh: 'äººå­—çº¹' }, cat: 'twill', matrix: createMatrix(8, 8, (x, y) => { const p=4, xM=x%(p*2), off=xM<p?xM:(p*2-1-xM); return ((y+off)%4)<2; }), rx: 8, ry: 8, chars: { durability: 4, drape: 4, breathability: 3, wrinkleResistance: 4, shine: 3 }, gsm: 1.15, diff: 3, apps: { ja: ['ã‚¸ãƒ£ã‚±ãƒƒãƒˆ'], zh: ['å¤¹å…‹'] } },
  { id: 'gabardine', name: { ja: 'ã‚®ãƒ£ãƒã‚¸ãƒ³', zh: 'åè¾¾å‘¢' }, cat: 'twill', matrix: createMatrix(4, 4, (x, y) => (x+y*2)%4<2), rx: 4, ry: 4, chars: { durability: 5, drape: 3, breathability: 3, wrinkleResistance: 5, shine: 4 }, gsm: 1.2, diff: 3, apps: { ja: ['ã‚³ãƒ¼ãƒˆ'], zh: ['å¤–å¥—'] } },
  { id: 'satin_5', name: { ja: '5æšæœ±å­', zh: 'äº”æšç¼' }, cat: 'satin', matrix: createMatrix(5, 5, (x, y) => (x+y*2)%5===0), rx: 5, ry: 5, chars: { durability: 2, drape: 5, breathability: 3, wrinkleResistance: 2, shine: 5 }, gsm: 1.0, diff: 3, apps: { ja: ['ãƒ‰ãƒ¬ã‚¹'], zh: ['ç¤¼æœ'] } },
  { id: 'sateen', name: { ja: 'ã‚µãƒ†ãƒ³', zh: 'è´¡ç¼' }, cat: 'satin', matrix: createMatrix(5, 5, (x, y) => (y+x*2)%5===0), rx: 5, ry: 5, chars: { durability: 3, drape: 5, breathability: 3, wrinkleResistance: 2, shine: 4 }, gsm: 1.0, diff: 3, apps: { ja: ['ã‚·ãƒ¼ãƒ„'], zh: ['åºŠå•'] } },
  { id: 'pique', name: { ja: 'ãƒ”ã‚±', zh: 'ç åœ°å¸ƒ' }, cat: 'dobby', matrix: createMatrix(4, 4, (x, y) => y%2===0), rx: 4, ry: 4, chars: { durability: 4, drape: 2, breathability: 5, wrinkleResistance: 4, shine: 2 }, gsm: 1.15, diff: 3, apps: { ja: ['ãƒãƒ­ã‚·ãƒ£ãƒ„'], zh: ['Poloè¡«'] } },
  { id: 'houndstooth', name: { ja: 'åƒé³¥æ ¼å­', zh: 'åƒé¸Ÿæ ¼' }, cat: 'dobby', matrix: createMatrix(8, 8, (x, y) => { const b=4, bx=Math.floor(x/b), by=Math.floor(y/b), lx=x%b, ly=y%b; return (bx+by)%2===0?(lx<2||ly<2):(lx>=2&&ly>=2); }), rx: 8, ry: 8, chars: { durability: 4, drape: 3, breathability: 3, wrinkleResistance: 4, shine: 2 }, gsm: 1.1, diff: 4, apps: { ja: ['ã‚¸ãƒ£ã‚±ãƒƒãƒˆ'], zh: ['å¤¹å…‹'] } },
  { id: 'waffle', name: { ja: 'ãƒ¯ãƒƒãƒ•ãƒ«', zh: 'åå¤«æ ¼' }, cat: 'dobby', matrix: createMatrix(8, 8, (x, y) => { const z=(Math.floor(x/4)+Math.floor(y/4))%2; return z===0?(x%4<2)===(y%4<2):(x%4>=2)===(y%4>=2); }), rx: 8, ry: 8, chars: { durability: 3, drape: 3, breathability: 5, wrinkleResistance: 2, shine: 1 }, gsm: 1.3, diff: 4, apps: { ja: ['ã‚¿ã‚ªãƒ«'], zh: ['æ¯›å·¾'] } },
  { id: 'damask', name: { ja: 'ãƒ€ãƒã‚¹ã‚¯', zh: 'é”¦ç¼' }, cat: 'jacquard', matrix: createMatrix(16, 16, (x, y) => { const cx=Math.abs(x-7.5), cy=Math.abs(y-7.5); return (cx+cy)<6||(x%4===0&&y%4===0); }), rx: 16, ry: 16, chars: { durability: 4, drape: 4, breathability: 3, wrinkleResistance: 3, shine: 4 }, gsm: 1.2, diff: 5, apps: { ja: ['ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¯ãƒ­ã‚¹'], zh: ['æ¡Œå¸ƒ'] } },
  { id: 'velvet', name: { ja: 'ãƒ™ãƒ«ãƒ™ãƒƒãƒˆ', zh: 'ä¸ç»’' }, cat: 'pile', matrix: createMatrix(4, 4, (x, y) => y%2===0), rx: 4, ry: 4, chars: { durability: 3, drape: 4, breathability: 2, wrinkleResistance: 2, shine: 4 }, gsm: 1.8, diff: 5, apps: { ja: ['ãƒ‰ãƒ¬ã‚¹'], zh: ['ç¤¼æœ'] } },
  { id: 'corduroy', name: { ja: 'ã‚³ãƒ¼ãƒ‡ãƒ¥ãƒ­ã‚¤', zh: 'ç¯èŠ¯ç»’' }, cat: 'pile', matrix: createMatrix(8, 4, (x, y) => x%8<4&&y%2===0), rx: 8, ry: 4, chars: { durability: 4, drape: 3, breathability: 3, wrinkleResistance: 3, shine: 2 }, gsm: 1.6, diff: 4, apps: { ja: ['ãƒ‘ãƒ³ãƒ„'], zh: ['è£¤å­'] } },
  { id: 'terry', name: { ja: 'ãƒ†ãƒªãƒ¼', zh: 'æ¯›åœˆå¸ƒ' }, cat: 'pile', matrix: createMatrix(4, 4, () => true), rx: 4, ry: 4, chars: { durability: 4, drape: 2, breathability: 5, wrinkleResistance: 2, shine: 1 }, gsm: 2.0, diff: 3, apps: { ja: ['ã‚¿ã‚ªãƒ«'], zh: ['æ¯›å·¾'] } },
  { id: 'seersucker', name: { ja: 'ã‚·ã‚¢ã‚µãƒƒã‚«ãƒ¼', zh: 'æ³¡æ³¡çº±' }, cat: 'special', matrix: createMatrix(8, 4, (x, y) => { const z=Math.floor(x/4)%2; return z===0?(x+y)%2===0:y%2===0; }), rx: 8, ry: 4, chars: { durability: 4, drape: 3, breathability: 5, wrinkleResistance: 4, shine: 1 }, gsm: 1.0, diff: 4, apps: { ja: ['å¤ç‰©'], zh: ['å¤è£…'] } },
  { id: 'double_cloth', name: { ja: 'äºŒé‡ç¹”', zh: 'åŒå±‚ç»‡' }, cat: 'special', matrix: createMatrix(8, 8, (x, y) => { const l=Math.floor(y/4); return l===0?(x+y)%2===0:(x+y)%2===1; }), rx: 8, ry: 8, chars: { durability: 5, drape: 2, breathability: 2, wrinkleResistance: 4, shine: 2 }, gsm: 2.0, diff: 5, apps: { ja: ['ã‚³ãƒ¼ãƒˆ'], zh: ['å¤–å¥—'] } },
];

// ============================================================
// ç³¸ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆç°¡ç•¥ç‰ˆï¼‰
// ============================================================
const YARN_DB = [
  { id: 'cotton_20', name: { ja: 'ã‚«ãƒ¼ãƒ‰ç¶¿ 20Ne', zh: 'æ™®æ¢³æ£‰ 20æ”¯' }, cat: 'cotton', comp: [{ f: 'cotton', p: 100 }], ne: 20, chars: { strength: 3, softness: 3, luster: 2, elasticity: 2, absorbency: 5, durability: 4 }, price: 2 },
  { id: 'cotton_40', name: { ja: 'ã‚«ãƒ¼ãƒ‰ç¶¿ 40Ne', zh: 'æ™®æ¢³æ£‰ 40æ”¯' }, cat: 'cotton', comp: [{ f: 'cotton', p: 100 }], ne: 40, chars: { strength: 3, softness: 4, luster: 2, elasticity: 2, absorbency: 5, durability: 3 }, price: 3 },
  { id: 'combed_40', name: { ja: 'ã‚³ãƒ¼ãƒç¶¿ 40Ne', zh: 'ç²¾æ¢³æ£‰ 40æ”¯' }, cat: 'cotton', comp: [{ f: 'cotton', p: 100 }], ne: 40, chars: { strength: 4, softness: 5, luster: 4, elasticity: 2, absorbency: 5, durability: 4 }, price: 4 },
  { id: 'combed_60', name: { ja: 'ã‚³ãƒ¼ãƒç¶¿ 60Ne', zh: 'ç²¾æ¢³æ£‰ 60æ”¯' }, cat: 'cotton', comp: [{ f: 'cotton', p: 100 }], ne: 60, chars: { strength: 3, softness: 5, luster: 4, elasticity: 2, absorbency: 5, durability: 3 }, price: 5 },
  { id: 'combed_80', name: { ja: 'ã‚³ãƒ¼ãƒç¶¿ 80Ne', zh: 'ç²¾æ¢³æ£‰ 80æ”¯' }, cat: 'cotton', comp: [{ f: 'cotton', p: 100 }], ne: 80, chars: { strength: 3, softness: 5, luster: 5, elasticity: 2, absorbency: 5, durability: 3 }, price: 6 },
  { id: 'linen_40', name: { ja: 'ãƒªãƒãƒ³ 40Lea', zh: 'äºšéº» 40æ”¯' }, cat: 'linen', comp: [{ f: 'linen', p: 100 }], ne: 24, chars: { strength: 5, softness: 2, luster: 4, elasticity: 1, absorbency: 5, durability: 5 }, price: 6 },
  { id: 'ramie', name: { ja: 'ãƒ©ãƒŸãƒ¼ 40Ne', zh: 'è‹éº» 40æ”¯' }, cat: 'linen', comp: [{ f: 'ramie', p: 100 }], ne: 40, chars: { strength: 5, softness: 2, luster: 5, elasticity: 1, absorbency: 5, durability: 5 }, price: 5 },
  { id: 'merino_60', name: { ja: 'ãƒ¡ãƒªãƒ 60Nm', zh: 'ç¾åˆ©å¥´ 60æ”¯' }, cat: 'wool', comp: [{ f: 'wool', p: 100 }], ne: 35, chars: { strength: 3, softness: 5, luster: 4, elasticity: 5, absorbency: 4, durability: 3 }, price: 6 },
  { id: 'worsted_48', name: { ja: 'æ¢³æ¯› 48Nm', zh: 'ç²¾çººæ¯› 48æ”¯' }, cat: 'wool', comp: [{ f: 'wool', p: 100 }], ne: 28, chars: { strength: 4, softness: 4, luster: 4, elasticity: 4, absorbency: 4, durability: 4 }, price: 5 },
  { id: 'cashmere', name: { ja: 'ã‚«ã‚·ãƒŸãƒ¤ 60Nm', zh: 'ç¾Šç»’ 60æ”¯' }, cat: 'wool', comp: [{ f: 'cashmere', p: 100 }], ne: 35, chars: { strength: 2, softness: 5, luster: 5, elasticity: 4, absorbency: 4, durability: 2 }, price: 8 },
  { id: 'silk_60', name: { ja: 'çµ¹ç´¡ 60Nm', zh: 'ç»¢çºº 60æ”¯' }, cat: 'silk', comp: [{ f: 'silk', p: 100 }], ne: 35, chars: { strength: 3, softness: 5, luster: 5, elasticity: 3, absorbency: 4, durability: 3 }, price: 7 },
  { id: 'poly_75d', name: { ja: 'ãƒãƒªã‚¨ã‚¹ãƒ†ãƒ« 75D', zh: 'æ¶¤çº¶ 75D' }, cat: 'synthetic', comp: [{ f: 'polyester', p: 100 }], ne: 71, chars: { strength: 5, softness: 3, luster: 4, elasticity: 4, absorbency: 1, durability: 5 }, price: 2 },
  { id: 'nylon_70d', name: { ja: 'ãƒŠã‚¤ãƒ­ãƒ³ 70D', zh: 'å°¼é¾™ 70D' }, cat: 'synthetic', comp: [{ f: 'nylon', p: 100 }], ne: 76, chars: { strength: 5, softness: 4, luster: 4, elasticity: 5, absorbency: 2, durability: 5 }, price: 3 },
  { id: 'viscose_40', name: { ja: 'ãƒ¬ãƒ¼ãƒ¨ãƒ³ 40Ne', zh: 'ç²˜èƒ¶ 40æ”¯' }, cat: 'regenerated', comp: [{ f: 'viscose', p: 100 }], ne: 40, chars: { strength: 2, softness: 5, luster: 5, elasticity: 2, absorbency: 5, durability: 2 }, price: 3 },
  { id: 'tencel_40', name: { ja: 'ãƒ†ãƒ³ã‚»ãƒ« 40Ne', zh: 'å¤©ä¸ 40æ”¯' }, cat: 'regenerated', comp: [{ f: 'lyocell', p: 100 }], ne: 40, chars: { strength: 4, softness: 5, luster: 4, elasticity: 2, absorbency: 5, durability: 4 }, price: 5 },
  { id: 'tc_65_35', name: { ja: 'TC 65/35', zh: 'TC 65/35' }, cat: 'blend', comp: [{ f: 'cotton', p: 65 }, { f: 'polyester', p: 35 }], ne: 30, chars: { strength: 4, softness: 4, luster: 3, elasticity: 3, absorbency: 4, durability: 5 }, price: 3 },
  { id: 'cotton_linen', name: { ja: 'ç¶¿éº» 55/45', zh: 'æ£‰éº» 55/45' }, cat: 'blend', comp: [{ f: 'cotton', p: 55 }, { f: 'linen', p: 45 }], ne: 30, chars: { strength: 4, softness: 3, luster: 3, elasticity: 2, absorbency: 5, durability: 5 }, price: 4 },
  { id: 'wool_poly', name: { ja: 'ã‚¦ãƒ¼ãƒ«ãƒãƒª 55/45', zh: 'æ¯›æ¶¤ 55/45' }, cat: 'blend', comp: [{ f: 'wool', p: 55 }, { f: 'polyester', p: 45 }], ne: 28, chars: { strength: 4, softness: 4, luster: 4, elasticity: 4, absorbency: 3, durability: 5 }, price: 4 },
  { id: 'cotton_spandex', name: { ja: 'ç¶¿ã‚¹ãƒ‘ãƒ³ 97/3', zh: 'æ£‰æ°¨ 97/3' }, cat: 'blend', comp: [{ f: 'cotton', p: 97 }, { f: 'spandex', p: 3 }], ne: 40, chars: { strength: 4, softness: 4, luster: 3, elasticity: 4, absorbency: 4, durability: 4 }, price: 4 },
  { id: 'coolmax', name: { ja: 'ã‚¯ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚¹', zh: 'CoolMax' }, cat: 'specialty', comp: [{ f: 'polyester', p: 100 }], ne: 71, chars: { strength: 5, softness: 3, luster: 3, elasticity: 4, absorbency: 2, durability: 5 }, price: 4, special: ['moisture'] },
];

// ============================================================
// ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ
// ============================================================
const SWATCHES = [
  "#000000","#ffffff","#c1121f","#2a6f97","#1d3557","#457b9d","#e9c46a","#f4a261","#e76f51","#264653",
  "#4f772d","#90a955","#8a5a44","#6a4c93","#b5179e","#7209b7","#560bad","#480ca8","#3a0ca3","#4361ee",
  "#4895ef","#4cc9f0","#118ab2","#06d6a0","#ffd166","#ef476f","#073b4c","#f72585","#3a5a40","#bc6c25"
];

// ============================================================
// ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
// ============================================================
function hexToRgb(hex) {
  const c = hex.replace('#','');
  const bigint = parseInt(c.length === 3 ? c.split('').map(x=>x+x).join('') : c, 16);
  return { r: (bigint >> 16) & 255, g: (bigint >> 8) & 255, b: bigint & 255 };
}
function rgbToHex(r, g, b) { return '#' + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join(''); }
function withAlpha(hex, a) { const { r, g, b } = hexToRgb(hex); return `rgba(${r},${g},${b},${a})`; }
function colorDistance(hex1, hex2) {
  const c1 = hexToRgb(hex1), c2 = hexToRgb(hex2);
  return Math.sqrt(Math.pow(c1.r - c2.r, 2) + Math.pow(c1.g - c2.g, 2) + Math.pow(c1.b - c2.b, 2));
}
function findNearestPantone(hex) {
  let nearest = PANTONE_DB[0], minDist = Infinity;
  PANTONE_DB.forEach(p => { const d = colorDistance(hex, p.hex); if (d < minDist) { minDist = d; nearest = p; } });
  return nearest;
}
function getWeave(id) { return WEAVE_DB.find(w => w.id === id); }
function getYarn(id) { return YARN_DB.find(y => y.id === id); }
function getComp(yarn, lang) { return yarn.comp.map(c => `${LANG[lang].fibers[c.f]||c.f} ${c.p}%`).join('/'); }

// å­£ç¯€åˆ¤å®š
function judgeSeason(config) {
  const yarn = getYarn(config.warpYarnId);
  const weave = getWeave(config.weaveId);
  const gsm = calcGSM(config);
  if (!yarn || !weave || !gsm) return 'all';

  const fiber = yarn.comp[0]?.f;
  const gsmVal = gsm.gsm;

  // å¤å‘ã: éº»ã€è–„åœ°ã€é€šæ°—æ€§é«˜ã„
  if (['linen', 'ramie'].includes(fiber) || gsmVal < 150 || weave.chars.breathability >= 4) {
    return 'ss';
  }
  // å†¬å‘ã: ã‚¦ãƒ¼ãƒ«ã€ã‚«ã‚·ãƒŸãƒ¤ã€åšåœ°
  if (['wool', 'cashmere'].includes(fiber) || gsmVal > 280) {
    return 'aw';
  }
  return 'all';
}

// é¡ä¼¼ç”Ÿåœ°æ¤œç´¢
function findSimilar(config) {
  const weave = getWeave(config.weaveId);
  const yarn = getYarn(config.warpYarnId);
  const gsm = calcGSM(config);
  if (!weave || !yarn || !gsm) return [];

  return SIMILAR_FABRICS.filter(f => {
    const weaveMatch = f.weave === config.weaveId || (weave.cat === getWeave(f.weave)?.cat);
    const yarnMatch = f.yarn === yarn.cat || yarn.comp.some(c => c.f === f.yarn);
    const epiMatch = config.epi >= f.epiRange[0] && config.epi <= f.epiRange[1];
    const gsmMatch = gsm.gsm >= f.gsmRange[0] && gsm.gsm <= f.gsmRange[1];
    return (weaveMatch || yarnMatch) && (epiMatch || gsmMatch);
  }).slice(0, 5);
}

// GSMè¨ˆç®—
function calcGSM(config) {
  const weave = getWeave(config.weaveId);
  const yarn = getYarn(config.warpYarnId);
  if (!weave || !yarn) return null;
  const ne = yarn.ne || 30;
  const tex = 590.5 / ne;
  let gsm = (config.epi * tex * 0.0254 + config.ppi * tex * 0.0254) * 0.4 * (weave.gsm || 1);
  let cat = gsm < 100 ? 'ultraLight' : gsm < 150 ? 'light' : gsm < 200 ? 'mediumLight' : gsm < 280 ? 'medium' : gsm < 350 ? 'heavy' : 'ultraHeavy';
  return { gsm: Math.round(gsm), cat };
}

// ãƒªã‚¹ã‚¯åˆ†æ
function analyzeRisks(config, lang) {
  const weave = getWeave(config.weaveId);
  const yarn = getYarn(config.warpYarnId);
  const risks = [];
  if (!weave || !yarn) return { risks: [], level: 'none' };

  if (yarn.ne > 60 && config.epi > 120) {
    risks.push({ icon: 'ğŸ§µ', title: lang === 'ja' ? 'ç³¸åˆ‡ã‚Œãƒªã‚¹ã‚¯é«˜' : 'æ–­çº¿é£é™©é«˜', level: 'high' });
  } else if (yarn.ne > 50 && config.epi > 100) {
    risks.push({ icon: 'ğŸ§µ', title: lang === 'ja' ? 'ç³¸åˆ‡ã‚Œæ³¨æ„' : 'æ³¨æ„æ–­çº¿', level: 'medium' });
  }
  if (weave.diff >= 5) {
    risks.push({ icon: 'ğŸ”§', title: lang === 'ja' ? 'é«˜é›£åº¦çµ„ç¹”' : 'é«˜éš¾åº¦ç»„ç»‡', level: 'high' });
  } else if (weave.diff >= 4) {
    risks.push({ icon: 'ğŸ”§', title: lang === 'ja' ? 'ä¸­é›£åº¦çµ„ç¹”' : 'ä¸­éš¾åº¦ç»„ç»‡', level: 'medium' });
  }

  const level = risks.some(r => r.level === 'high') ? 'high' : risks.some(r => r.level === 'medium') ? 'medium' : risks.length ? 'low' : 'none';
  return { risks, level };
}

// ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆ
function randomGenerate() {
  const weave = WEAVE_DB[Math.floor(Math.random() * WEAVE_DB.length)];
  const yarn = YARN_DB[Math.floor(Math.random() * YARN_DB.length)];
  const warpColors = [SWATCHES[Math.floor(Math.random() * SWATCHES.length)]];
  const weftColors = [SWATCHES[Math.floor(Math.random() * SWATCHES.length)]];
  if (Math.random() > 0.5) warpColors.push(SWATCHES[Math.floor(Math.random() * SWATCHES.length)]);
  if (Math.random() > 0.5) weftColors.push(SWATCHES[Math.floor(Math.random() * SWATCHES.length)]);
  return {
    weaveId: weave.id,
    weaveCat: weave.cat,
    warpYarnId: yarn.id,
    weftYarnId: yarn.id,
    yarnCat: yarn.cat,
    warpColors,
    weftColors,
    pattern: ['check', 'stripe', 'solid'][Math.floor(Math.random() * 3)],
    epi: 80 + Math.floor(Math.random() * 60),
    ppi: 60 + Math.floor(Math.random() * 50),
  };
}

// ============================================================
// æç”»
// ============================================================
function drawFabric(ctx, w, h, config, withLogo = false) {
  const weave = getWeave(config.weaveId);
  if (!weave) return;
  ctx.clearRect(0, 0, w, h);
  const sp = config.pitch * config.zoom;
  const { matrix, rx, ry } = weave;
  const cw = sp / rx, ch = sp / ry;

  for (let y = 0; y < h; y += ch) {
    for (let x = 0; x < w; x += cw) {
      let warpC, weftC;
      if (config.pattern === 'solid') { warpC = config.warpColors[0]; weftC = config.weftColors[0]; }
      else if (config.pattern === 'stripe') { warpC = config.warpColors[Math.floor(x / sp) % config.warpColors.length]; weftC = config.weftColors[0]; }
      else { warpC = config.warpColors[Math.floor(x / sp) % config.warpColors.length]; weftC = config.weftColors[Math.floor(y / sp) % config.weftColors.length]; }

      const mx = Math.floor((x / cw) % rx), my = Math.floor((y / ch) % ry);
      const isWarp = matrix[my]?.[mx] ?? true;
      ctx.fillStyle = isWarp ? warpC : weftC;
      ctx.fillRect(x, y, cw + 0.5, ch + 0.5);
      ctx.fillStyle = isWarp ? withAlpha(weftC, 0.1) : withAlpha(warpC, 0.1);
      ctx.fillRect(x, y, cw + 0.5, ch + 0.5);
    }
  }

  // JYUKOãƒ­ã‚´
  if (withLogo) {
    ctx.save();
    ctx.font = 'bold 18px Arial';
    ctx.fillStyle = '#7cb342';
    ctx.textAlign = 'right';
    ctx.textBaseline = 'bottom';
    ctx.fillText('JYUKO co.,ltd', w - 10, h - 10);
    ctx.restore();
  }
}

// ============================================================
// ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
// ============================================================
const app = document.getElementById('app');
let state = {
  lang: 'ja',
  pattern: 'check',
  weaveId: 'oxford',
  weaveCat: 'plain',
  warpColors: ['#1d3557', '#e76f51'],
  weftColors: ['#ffffff', '#e9c46a'],
  warpYarnId: 'combed_40',
  weftYarnId: 'combed_40',
  yarnCat: 'cotton',
  pitch: 28,
  zoom: 1,
  epi: 110,
  ppi: 90,
  tab: 'design',
  modal: null,
  editColor: null,
  compareMode: false,
  savedConfig: null,
};

function setState(ns) { Object.assign(state, ns); render(); }

function render() {
  const L = LANG[state.lang];
  const weave = getWeave(state.weaveId);
  const warpYarn = getYarn(state.warpYarnId);
  const risks = analyzeRisks(state, state.lang);
  const gsm = calcGSM(state);
  const season = judgeSeason(state);
  const similar = findSimilar(state);
  const riskColors = { none: '#10B981', low: '#84CC16', medium: '#F59E0B', high: '#EF4444' };

  app.innerHTML = `
    <header class="mb-4 flex items-center justify-between flex-wrap gap-2 no-print">
      <div>
        <h1 class="text-2xl font-bold">${L.title}</h1>
        <p class="text-sm text-neutral-500">${L.subtitle}</p>
      </div>
      <div class="flex items-center gap-2 flex-wrap">
        <button onclick="setState({lang: state.lang === 'ja' ? 'zh' : 'ja'})" class="px-3 py-1.5 rounded-lg bg-neutral-200 text-sm font-medium">
          ${state.lang === 'ja' ? 'ğŸ‡¨ğŸ‡³ ä¸­æ–‡' : 'ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª'}
        </button>
        ${risks.risks.length > 0 ? `<button onclick="setState({modal:'risk'})" class="px-3 py-1.5 rounded-lg text-white text-sm" style="background:${riskColors[risks.level]}">${risks.risks.length} ${L.risks}</button>` : `<span class="px-3 py-1.5 rounded-lg bg-green-100 text-green-700 text-sm">${L.noRisk}</span>`}
        <button onclick="setState({modal:'selling'})" class="px-3 py-1.5 rounded-lg bg-blue-600 text-white text-sm">${L.sellingPoints}</button>
      </div>
    </header>

    <div class="flex gap-1 mb-4 bg-neutral-200 p-1 rounded-xl w-fit flex-wrap no-print">
      ${['design', 'weave', 'yarn', 'specs', 'tools'].map(t => `
        <button onclick="setState({tab:'${t}'})" class="px-4 py-2 rounded-lg text-sm font-medium ${state.tab === t ? 'bg-white shadow' : 'hover:bg-neutral-100'}">${L.tabs[t]}</button>
      `).join('')}
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-4">
      <section class="lg:col-span-5 bg-white rounded-2xl shadow p-4 space-y-4 no-print">
        ${state.tab === 'design' ? renderDesign(L) : ''}
        ${state.tab === 'weave' ? renderWeave(L, weave) : ''}
        ${state.tab === 'yarn' ? renderYarn(L, warpYarn) : ''}
        ${state.tab === 'specs' ? renderSpecs(L, weave, warpYarn, gsm, season, similar) : ''}
        ${state.tab === 'tools' ? renderTools(L) : ''}
      </section>

      <section class="lg:col-span-7 bg-white rounded-2xl shadow p-4">
        <div class="flex items-center justify-between mb-3">
          <h2 class="font-medium">${L.preview}</h2>
          <div class="text-sm text-neutral-500">${weave?.name[state.lang] || ''}</div>
        </div>
        ${state.compareMode && state.savedConfig ? `
          <div class="grid grid-cols-2 gap-2 mb-2">
            <div class="text-center text-sm font-medium">${L.fabricA} (${L.current})</div>
            <div class="text-center text-sm font-medium">${L.fabricB}</div>
          </div>
          <div class="grid grid-cols-2 gap-2">
            <canvas id="canvasA" class="rounded-xl border shadow-inner w-full"></canvas>
            <canvas id="canvasB" class="rounded-xl border shadow-inner w-full"></canvas>
          </div>
        ` : `
          <div class="flex justify-center">
            <canvas id="canvas" class="rounded-xl border shadow-inner" style="max-width:100%"></canvas>
          </div>
        `}
        <div class="mt-4 no-print">
          <label class="block text-sm font-medium mb-2">${L.quickColors}</label>
          <div class="flex flex-wrap gap-1">
            ${SWATCHES.map(hex => `<button class="w-7 h-7 rounded-md border border-neutral-300 color-swatch" style="background:${hex}" onclick="quickColor('${hex}')" title="${hex}"></button>`).join('')}
          </div>
        </div>
      </section>
    </div>

    ${state.modal === 'risk' ? renderRiskModal(L, risks, riskColors) : ''}
    ${state.modal === 'selling' ? renderSellingModal(L) : ''}
    ${state.modal === 'spec' ? renderSpecModal(L, weave, warpYarn, gsm, season) : ''}
    ${state.modal === 'glossary' ? renderGlossaryModal(L) : ''}
    ${state.modal === 'pantone' ? renderPantoneModal(L) : ''}
    ${state.modal === 'trend' ? renderTrendModal(L) : ''}
  `;

  // Canvasæç”»
  setTimeout(() => {
    if (state.compareMode && state.savedConfig) {
      const cA = document.getElementById('canvasA');
      const cB = document.getElementById('canvasB');
      if (cA && cB) {
        [cA, cB].forEach((c, i) => {
          const dpr = window.devicePixelRatio || 1;
          const w = 240, h = 240;
          c.width = w * dpr; c.height = h * dpr;
          c.style.width = w + 'px'; c.style.height = h + 'px';
          const ctx = c.getContext('2d');
          ctx.scale(dpr, dpr);
          drawFabric(ctx, w, h, i === 0 ? state : state.savedConfig, true);
        });
      }
    } else {
      const canvas = document.getElementById('canvas');
      if (canvas) {
        const dpr = window.devicePixelRatio || 1;
        const w = 500, h = 500;
        canvas.width = w * dpr; canvas.height = h * dpr;
        canvas.style.width = w + 'px'; canvas.style.height = h + 'px';
        const ctx = canvas.getContext('2d');
        ctx.scale(dpr, dpr);
        drawFabric(ctx, w, h, state, true);
      }
    }
  }, 0);
}

function renderDesign(L) {
  return `
    <div>
      <label class="block text-sm font-medium mb-2">${L.pattern}</label>
      <div class="flex gap-2 flex-wrap">
        ${['check', 'stripe', 'solid'].map(p => `<button onclick="setState({pattern:'${p}'})" class="px-4 py-2 rounded-lg border text-sm ${state.pattern === p ? 'bg-neutral-900 text-white' : 'hover:border-neutral-400'}">${L.patterns[p]}</button>`).join('')}
      </div>
    </div>
    ${renderColorMgr('warp', L.warpColor, state.warpColors)}
    ${renderColorMgr('weft', L.weftColor, state.weftColors)}
    <div>
      <label class="block text-sm font-medium mb-1">${L.pitch}: <span class="font-bold">${state.pitch}px</span></label>
      <input type="range" min="8" max="80" value="${state.pitch}" onchange="setState({pitch:+this.value})" class="w-full accent-neutral-900">
    </div>
    <div>
      <label class="block text-sm font-medium mb-1">${L.zoom}: <span class="font-bold">${state.zoom.toFixed(1)}x</span></label>
      <input type="range" min="0.5" max="3" step="0.1" value="${state.zoom}" onchange="setState({zoom:+this.value})" class="w-full accent-neutral-900">
      <div class="flex gap-2 mt-1">${[0.5,1,1.5,2,3].map(z => `<button onclick="setState({zoom:${z}})" class="px-2 py-1 text-xs rounded ${state.zoom===z?'bg-neutral-900 text-white':'bg-neutral-100'}">${z}x</button>`).join('')}</div>
    </div>
  `;
}

function renderColorMgr(type, label, colors) {
  return `
    <div>
      <label class="block text-sm font-medium mb-2 tooltip" data-tip="${type === 'warp' ? (state.lang === 'ja' ? 'ç¸¦æ–¹å‘ã®ç³¸' : 'çºµå‘çº±çº¿') : (state.lang === 'ja' ? 'æ¨ªæ–¹å‘ã®ç³¸' : 'æ¨ªå‘çº±çº¿')}">${label}</label>
      <div class="flex flex-wrap gap-2 items-center">
        ${colors.map((c, i) => `
          <div class="relative group">
            <button class="w-10 h-10 rounded-lg border-2 border-neutral-300 shadow-sm hover:border-neutral-500" style="background:${c}" onclick="toggleEdit('${type}',${i})"></button>
            ${colors.length > 1 ? `<button onclick="removeColor('${type}',${i})" class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white rounded-full text-xs opacity-0 group-hover:opacity-100">Ã—</button>` : ''}
            ${state.editColor === type + i ? `
              <div class="absolute top-12 left-0 z-20 bg-white rounded-lg shadow-xl p-2 border">
                <input type="color" value="${c}" onchange="updColor('${type}',${i},this.value)" class="w-full h-8 mb-2">
                <div class="grid grid-cols-5 gap-1">${SWATCHES.slice(0,15).map(hex => `<button class="w-6 h-6 rounded border" style="background:${hex}" onclick="updColor('${type}',${i},'${hex}');setState({editColor:null})"></button>`).join('')}</div>
              </div>
            ` : ''}
          </div>
        `).join('')}
        ${colors.length < 8 ? `<button onclick="addColor('${type}')" class="w-10 h-10 rounded-lg border-2 border-dashed border-neutral-300 text-neutral-400 hover:border-neutral-500">+</button>` : ''}
      </div>
    </div>
  `;
}

function renderWeave(L, weave) {
  const filtered = WEAVE_DB.filter(w => w.cat === state.weaveCat);
  return `
    <div>
      <label class="block text-sm font-medium mb-2">${L.weaveCategory}</label>
      <div class="flex flex-wrap gap-2">
        ${Object.keys(L.weaveCategories).map(c => `<button onclick="setWeaveCat('${c}')" class="px-3 py-1.5 rounded-lg border text-sm ${state.weaveCat===c?'bg-neutral-900 text-white':'hover:border-neutral-400'}">${L.weaveCategories[c]}</button>`).join('')}
      </div>
    </div>
    <div>
      <label class="block text-sm font-medium mb-2">${L.selectWeave}</label>
      <div class="grid grid-cols-2 gap-2 max-h-64 overflow-y-auto">
        ${filtered.map(w => `<button onclick="setState({weaveId:'${w.id}'})" class="p-3 rounded-lg border text-left ${state.weaveId===w.id?'border-neutral-900 bg-neutral-50':'hover:border-neutral-400'}"><div class="font-medium text-sm">${w.name[state.lang]}</div></button>`).join('')}
      </div>
    </div>
    ${weave ? `
      <div class="bg-neutral-50 rounded-xl p-3">
        <h4 class="font-medium mb-2">${weave.name[state.lang]}</h4>
        <div class="grid grid-cols-5 gap-1 text-xs">
          ${Object.entries(weave.chars).map(([k,v]) => `<div class="text-center"><div class="font-medium">${v}/5</div><div class="text-neutral-500">${L.characteristics[k]||k}</div></div>`).join('')}
        </div>
        <div class="mt-2 flex flex-wrap gap-1">${(weave.apps[state.lang]||[]).map(a => `<span class="px-2 py-0.5 bg-neutral-200 rounded text-xs">${a}</span>`).join('')}</div>
      </div>
    ` : ''}
  `;
}

function renderYarn(L, warpYarn) {
  const filtered = YARN_DB.filter(y => y.cat === state.yarnCat);
  return `
    <div>
      <label class="block text-sm font-medium mb-2">${L.yarnCategory}</label>
      <div class="flex flex-wrap gap-2">
        ${Object.keys(L.fiberCategories).map(c => `<button onclick="setState({yarnCat:'${c}'})" class="px-3 py-1.5 rounded-lg border text-sm ${state.yarnCat===c?'bg-neutral-900 text-white':'hover:border-neutral-400'}">${L.fiberCategories[c]}</button>`).join('')}
      </div>
    </div>
    <div>
      <label class="text-sm font-medium mb-2 block">${L.warpYarn}</label>
      <select onchange="setState({warpYarnId:this.value})" class="w-full p-2 border rounded-lg text-sm">
        ${filtered.map(y => `<option value="${y.id}" ${state.warpYarnId===y.id?'selected':''}>${y.name[state.lang]}</option>`).join('')}
      </select>
    </div>
    <div>
      <label class="text-sm font-medium mb-2 block">${L.weftYarn}</label>
      <select onchange="setState({weftYarnId:this.value})" class="w-full p-2 border rounded-lg text-sm">
        ${filtered.map(y => `<option value="${y.id}" ${state.weftYarnId===y.id?'selected':''}>${y.name[state.lang]}</option>`).join('')}
      </select>
    </div>
    ${warpYarn ? `
      <div class="bg-neutral-50 rounded-xl p-3">
        <h4 class="font-medium text-sm mb-2">${L.warpYarn}: ${warpYarn.name[state.lang]}</h4>
        <div class="text-xs text-neutral-600 mb-2">${getComp(warpYarn, state.lang)}</div>
        <div class="grid grid-cols-3 gap-2 text-xs">
          ${Object.entries(warpYarn.chars).slice(0,6).map(([k,v]) => `<div><div class="font-medium">${v}/5</div><div class="text-neutral-500">${L.characteristics[k]||k}</div></div>`).join('')}
        </div>
      </div>
    ` : ''}
  `;
}

function renderSpecs(L, weave, warpYarn, gsm, season, similar) {
  const seasonLabel = season === 'ss' ? L.springSum : season === 'aw' ? L.autumnWin : L.allSeason;
  const seasonColor = season === 'ss' ? 'bg-orange-100 text-orange-700' : season === 'aw' ? 'bg-blue-100 text-blue-700' : 'bg-gray-100 text-gray-700';
  return `
    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium mb-1 tooltip" data-tip="Ends Per Inch">${L.epi}: <span class="font-bold">${state.epi}</span></label>
        <input type="range" min="40" max="200" value="${state.epi}" onchange="setState({epi:+this.value})" class="w-full accent-neutral-900">
      </div>
      <div>
        <label class="block text-sm font-medium mb-1 tooltip" data-tip="Picks Per Inch">${L.ppi}: <span class="font-bold">${state.ppi}</span></label>
        <input type="range" min="40" max="200" value="${state.ppi}" onchange="setState({ppi:+this.value})" class="w-full accent-neutral-900">
      </div>
    </div>
    ${gsm ? `
      <div class="bg-neutral-100 rounded-xl p-4">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-lg font-bold tooltip" data-tip="Grams per Square Meter">${gsm.gsm} gsm</div>
            <div class="text-sm text-neutral-600">${L.weightCat[gsm.cat]}</div>
          </div>
          <div class="px-3 py-1 rounded-full text-sm ${seasonColor}">${L.season}: ${seasonLabel}</div>
        </div>
      </div>
    ` : ''}
    <div class="bg-neutral-50 rounded-xl p-4 space-y-2">
      <h4 class="font-medium">${L.fabricSummary}</h4>
      <div class="grid grid-cols-2 gap-4 text-sm">
        <div><div class="text-neutral-500">${L.weaveType}</div><div class="font-medium">${weave?.name[state.lang]||'-'}</div></div>
        <div><div class="text-neutral-500">${L.difficulty}</div><div class="font-medium">${'â˜…'.repeat(weave?.diff||1)}</div></div>
        <div><div class="text-neutral-500">${L.warpYarn}</div><div class="font-medium">${warpYarn?.name[state.lang]||'-'}</div></div>
        <div><div class="text-neutral-500">${L.weftYarn}</div><div class="font-medium">${getYarn(state.weftYarnId)?.name[state.lang]||'-'}</div></div>
      </div>
    </div>
    ${similar.length > 0 ? `
      <div class="bg-blue-50 rounded-xl p-3">
        <h4 class="font-medium text-sm mb-2">${L.similar}</h4>
        <div class="flex flex-wrap gap-2">
          ${similar.map(s => `<span class="px-2 py-1 bg-white rounded text-xs">${s.name[state.lang]}</span>`).join('')}
        </div>
      </div>
    ` : ''}
    <div class="flex gap-2">
      <button onclick="downloadPng()" class="flex-1 px-4 py-2 rounded-xl bg-neutral-900 text-white text-sm font-medium">${L.savePng}</button>
      <button onclick="setState({modal:'spec'})" class="flex-1 px-4 py-2 rounded-xl bg-blue-600 text-white text-sm font-medium">${L.specSheet}</button>
    </div>
  `;
}

function renderTools(L) {
  return `
    <div class="grid grid-cols-2 gap-3">
      <button onclick="setState({modal:'spec'})" class="p-4 rounded-xl border hover:border-neutral-400 text-left">
        <div class="text-2xl mb-1">ğŸ“„</div>
        <div class="font-medium text-sm">${L.specSheet}</div>
      </button>
      <button onclick="toggleCompare()" class="p-4 rounded-xl border hover:border-neutral-400 text-left ${state.compareMode ? 'bg-blue-50 border-blue-400' : ''}">
        <div class="text-2xl mb-1">âš–ï¸</div>
        <div class="font-medium text-sm">${L.compare}</div>
      </button>
      <button onclick="setState({modal:'glossary'})" class="p-4 rounded-xl border hover:border-neutral-400 text-left">
        <div class="text-2xl mb-1">ğŸ“–</div>
        <div class="font-medium text-sm">${L.glossary}</div>
      </button>
      <button onclick="setState({modal:'pantone'})" class="p-4 rounded-xl border hover:border-neutral-400 text-left">
        <div class="text-2xl mb-1">ğŸ¨</div>
        <div class="font-medium text-sm">${L.pantone}</div>
      </button>
      <button onclick="setState({modal:'trend'})" class="p-4 rounded-xl border hover:border-neutral-400 text-left">
        <div class="text-2xl mb-1">âœ¨</div>
        <div class="font-medium text-sm">${L.trend}</div>
      </button>
      <button onclick="applyRandom()" class="p-4 rounded-xl border hover:border-neutral-400 text-left">
        <div class="text-2xl mb-1">ğŸ²</div>
        <div class="font-medium text-sm">${L.random}</div>
      </button>
    </div>
  `;
}

function renderRiskModal(L, risks, colors) {
  return `
    <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onclick="if(event.target===this)setState({modal:null})">
      <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[80vh] overflow-hidden">
        <div class="flex items-center justify-between p-4 border-b">
          <h3 class="font-bold text-lg">${L.riskAnalysis}</h3>
          <button onclick="setState({modal:null})" class="w-8 h-8 rounded-full hover:bg-neutral-100 flex items-center justify-center">Ã—</button>
        </div>
        <div class="p-4 overflow-y-auto">
          ${risks.risks.length === 0 ? `<p class="text-center py-8 text-neutral-500">${L.noRisk}</p>` : `
            <div class="space-y-3">
              ${risks.risks.map(r => `
                <div class="p-3 rounded-lg border-l-4" style="border-color:${colors[r.level]};background:${colors[r.level]}10">
                  <div class="flex items-center gap-2">
                    <span class="text-lg">${r.icon}</span>
                    <span class="font-medium">${r.title}</span>
                    <span class="px-2 py-0.5 rounded text-xs text-white" style="background:${colors[r.level]}">${L.riskLevels[r.level]}</span>
                  </div>
                </div>
              `).join('')}
            </div>
          `}
        </div>
      </div>
    </div>
  `;
}

function renderSellingModal(L) {
  const yarn = getYarn(state.warpYarnId);
  const weave = getWeave(state.weaveId);
  const points = [];
  if (yarn?.comp[0]?.f === 'cotton') points.push({ cat: state.lang==='ja'?'ç´ æ':'æè´¨', title: state.lang==='ja'?'ã‚³ãƒƒãƒˆãƒ³ã®å¿ƒåœ°ã‚ˆã•':'æ£‰èŠ±çš„èˆ’é€‚æ„Ÿ' });
  if (yarn?.comp[0]?.f === 'silk') points.push({ cat: state.lang==='ja'?'ç´ æ':'æè´¨', title: state.lang==='ja'?'ã‚·ãƒ«ã‚¯ã®å…‰æ²¢':'ä¸ç»¸çš„å…‰æ³½' });
  if (weave?.chars.drape >= 4) points.push({ cat: state.lang==='ja'?'ç¹”ã‚Š':'ç»‡ç‰©', title: state.lang==='ja'?'å„ªç¾ãªãƒ‰ãƒ¬ãƒ¼ãƒ—':'ä¼˜ç¾çš„å‚æ„Ÿ' });
  if (weave?.chars.durability >= 4) points.push({ cat: state.lang==='ja'?'ç¹”ã‚Š':'ç»‡ç‰©', title: state.lang==='ja'?'ä¸ˆå¤«ã§é•·æŒã¡':'ç»ä¹…è€ç”¨' });

  return `
    <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onclick="if(event.target===this)setState({modal:null})">
      <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[80vh] overflow-hidden">
        <div class="flex items-center justify-between p-4 border-b">
          <h3 class="font-bold text-lg">${L.sellingPoints}</h3>
          <button onclick="setState({modal:null})" class="w-8 h-8 rounded-full hover:bg-neutral-100 flex items-center justify-center">Ã—</button>
        </div>
        <div class="p-4 overflow-y-auto space-y-3">
          ${points.map(p => `
            <div class="p-3 bg-neutral-50 rounded-lg">
              <span class="px-2 py-0.5 bg-neutral-200 rounded text-xs mr-2">${p.cat}</span>
              <span class="font-medium">${p.title}</span>
            </div>
          `).join('')}
          ${points.length === 0 ? `<p class="text-center py-8 text-neutral-500">...</p>` : ''}
        </div>
      </div>
    </div>
  `;
}

function renderSpecModal(L, weave, warpYarn, gsm, season) {
  const weftYarn = getYarn(state.weftYarnId);
  const seasonLabel = season === 'ss' ? L.springSum : season === 'aw' ? L.autumnWin : L.allSeason;
  const date = new Date().toLocaleDateString(state.lang === 'ja' ? 'ja-JP' : 'zh-CN');

  return `
    <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onclick="if(event.target===this)setState({modal:null})">
      <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden">
        <div class="flex items-center justify-between p-4 border-b no-print">
          <h3 class="font-bold text-lg">${L.specSheet}</h3>
          <div class="flex gap-2">
            <button onclick="window.print()" class="px-3 py-1.5 rounded-lg bg-neutral-200 text-sm">${L.print}</button>
            <button onclick="setState({modal:null})" class="w-8 h-8 rounded-full hover:bg-neutral-100 flex items-center justify-center">Ã—</button>
          </div>
        </div>
        <div class="p-6 overflow-y-auto" id="specContent">
          <div class="flex justify-between items-start mb-6">
            <div>
              <h2 class="text-xl font-bold">${state.lang === 'ja' ? 'ç”Ÿåœ°ä»•æ§˜æ›¸' : 'é¢æ–™è§„æ ¼ä¹¦'}</h2>
              <p class="text-sm text-neutral-500">${date}</p>
            </div>
            <div class="text-right">
              <div class="font-bold text-lg" style="color:#7cb342">JYUKO co.,ltd</div>
            </div>
          </div>

          <table class="w-full border-collapse text-sm mb-6">
            <tr class="border-b"><td class="py-2 text-neutral-500 w-1/3">${L.weaveType}</td><td class="py-2 font-medium">${weave?.name[state.lang]||'-'}</td></tr>
            <tr class="border-b"><td class="py-2 text-neutral-500">${L.warpYarn}</td><td class="py-2 font-medium">${warpYarn?.name[state.lang]||'-'} (${getComp(warpYarn, state.lang)})</td></tr>
            <tr class="border-b"><td class="py-2 text-neutral-500">${L.weftYarn}</td><td class="py-2 font-medium">${weftYarn?.name[state.lang]||'-'} (${getComp(weftYarn, state.lang)})</td></tr>
            <tr class="border-b"><td class="py-2 text-neutral-500">${L.epi}</td><td class="py-2 font-medium">${state.epi}</td></tr>
            <tr class="border-b"><td class="py-2 text-neutral-500">${L.ppi}</td><td class="py-2 font-medium">${state.ppi}</td></tr>
            <tr class="border-b"><td class="py-2 text-neutral-500">${L.gsm}</td><td class="py-2 font-medium">${gsm?.gsm || '-'} g/mÂ² (${L.weightCat[gsm?.cat]||'-'})</td></tr>
            <tr class="border-b"><td class="py-2 text-neutral-500">${L.season}</td><td class="py-2 font-medium">${seasonLabel}</td></tr>
            <tr class="border-b"><td class="py-2 text-neutral-500">${L.difficulty}</td><td class="py-2 font-medium">${'â˜…'.repeat(weave?.diff||1)}</td></tr>
          </table>

          <div class="mb-4">
            <h4 class="font-medium mb-2">${state.lang === 'ja' ? 'ä½¿ç”¨è‰²' : 'ä½¿ç”¨é¢œè‰²'}</h4>
            <div class="flex gap-4">
              <div>
                <div class="text-xs text-neutral-500 mb-1">${L.warpColor}</div>
                <div class="flex gap-1">
                  ${state.warpColors.map(c => {
                    const p = findNearestPantone(c);
                    return `<div class="text-center"><div class="w-8 h-8 rounded border" style="background:${c}"></div><div class="text-xs mt-1">${p.code}</div></div>`;
                  }).join('')}
                </div>
              </div>
              <div>
                <div class="text-xs text-neutral-500 mb-1">${L.weftColor}</div>
                <div class="flex gap-1">
                  ${state.weftColors.map(c => {
                    const p = findNearestPantone(c);
                    return `<div class="text-center"><div class="w-8 h-8 rounded border" style="background:${c}"></div><div class="text-xs mt-1">${p.code}</div></div>`;
                  }).join('')}
                </div>
              </div>
            </div>
          </div>

          <div class="text-center text-xs text-neutral-400 mt-8">
            Generated by JYUKO Fabric Simulator
          </div>
        </div>
      </div>
    </div>
  `;
}

function renderGlossaryModal(L) {
  const terms = GLOSSARY[state.lang] || GLOSSARY.ja;
  return `
    <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onclick="if(event.target===this)setState({modal:null})">
      <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[80vh] overflow-hidden">
        <div class="flex items-center justify-between p-4 border-b">
          <h3 class="font-bold text-lg">${L.glossary}</h3>
          <button onclick="setState({modal:null})" class="w-8 h-8 rounded-full hover:bg-neutral-100 flex items-center justify-center">Ã—</button>
        </div>
        <div class="p-4 overflow-y-auto max-h-[60vh] space-y-3">
          ${Object.entries(terms).map(([term, def]) => `
            <div class="p-3 bg-neutral-50 rounded-lg">
              <div class="font-bold text-sm mb-1">${term}</div>
              <div class="text-sm text-neutral-600">${def}</div>
            </div>
          `).join('')}
        </div>
      </div>
    </div>
  `;
}

function renderPantoneModal(L) {
  const allColors = [...state.warpColors, ...state.weftColors];
  return `
    <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onclick="if(event.target===this)setState({modal:null})">
      <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[80vh] overflow-hidden">
        <div class="flex items-center justify-between p-4 border-b">
          <h3 class="font-bold text-lg">${L.pantone}</h3>
          <button onclick="setState({modal:null})" class="w-8 h-8 rounded-full hover:bg-neutral-100 flex items-center justify-center">Ã—</button>
        </div>
        <div class="p-4 overflow-y-auto space-y-4">
          <p class="text-sm text-neutral-500">${L.nearestPantone}</p>
          ${allColors.map(c => {
            const p = findNearestPantone(c);
            return `
              <div class="flex items-center gap-4 p-3 bg-neutral-50 rounded-lg">
                <div class="w-12 h-12 rounded-lg border" style="background:${c}"></div>
                <div class="flex-1">
                  <div class="text-xs text-neutral-500">HEX: ${c.toUpperCase()}</div>
                  <div class="font-bold">${p.code}</div>
                  <div class="text-sm">${p.name}</div>
                </div>
                <div class="w-12 h-12 rounded-lg border" style="background:${p.hex}"></div>
              </div>
            `;
          }).join('')}
        </div>
      </div>
    </div>
  `;
}

function renderTrendModal(L) {
  return `
    <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onclick="if(event.target===this)setState({modal:null})">
      <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[80vh] overflow-hidden">
        <div class="flex items-center justify-between p-4 border-b">
          <h3 class="font-bold text-lg">${L.trend} 2025</h3>
          <button onclick="setState({modal:null})" class="w-8 h-8 rounded-full hover:bg-neutral-100 flex items-center justify-center">Ã—</button>
        </div>
        <div class="p-4 overflow-y-auto space-y-4">
          <div>
            <h4 class="font-medium mb-2">${L.springSum}</h4>
            <div class="grid grid-cols-3 gap-2">
              ${TREND_COLORS_2025.ss.map(c => `
                <button onclick="applyTrendColor('${c.hex}')" class="p-2 rounded-lg border hover:border-neutral-400 text-center">
                  <div class="w-full h-10 rounded mb-1" style="background:${c.hex}"></div>
                  <div class="text-xs font-medium">${c.name[state.lang]}</div>
                  <div class="text-xs text-neutral-500">${c.pantone}</div>
                </button>
              `).join('')}
            </div>
          </div>
          <div>
            <h4 class="font-medium mb-2">${L.autumnWin}</h4>
            <div class="grid grid-cols-3 gap-2">
              ${TREND_COLORS_2025.aw.map(c => `
                <button onclick="applyTrendColor('${c.hex}')" class="p-2 rounded-lg border hover:border-neutral-400 text-center">
                  <div class="w-full h-10 rounded mb-1" style="background:${c.hex}"></div>
                  <div class="text-xs font-medium">${c.name[state.lang]}</div>
                  <div class="text-xs text-neutral-500">${c.pantone}</div>
                </button>
              `).join('')}
            </div>
          </div>
        </div>
      </div>
    </div>
  `;
}

// ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°
window.setState = setState;
window.toggleEdit = (t, i) => setState({ editColor: state.editColor === t + i ? null : t + i });
window.updColor = (t, i, c) => { const arr = t === 'warp' ? [...state.warpColors] : [...state.weftColors]; arr[i] = c; setState(t === 'warp' ? { warpColors: arr } : { weftColors: arr }); };
window.addColor = t => { const arr = t === 'warp' ? [...state.warpColors] : [...state.weftColors]; if (arr.length < 8) arr.push(SWATCHES[Math.floor(Math.random() * SWATCHES.length)]); setState(t === 'warp' ? { warpColors: arr } : { weftColors: arr }); };
window.removeColor = (t, i) => { const arr = t === 'warp' ? [...state.warpColors] : [...state.weftColors]; if (arr.length > 1) arr.splice(i, 1); setState(t === 'warp' ? { warpColors: arr } : { weftColors: arr }); };
window.quickColor = hex => { const arr = state.warpColors.length < 2 ? [...state.warpColors, hex] : [state.warpColors[0], hex]; setState({ warpColors: arr }); };
window.setWeaveCat = c => { const first = WEAVE_DB.find(w => w.cat === c); setState({ weaveCat: c, weaveId: first?.id || state.weaveId }); };
window.downloadPng = () => { const c = document.getElementById('canvas') || document.getElementById('canvasA'); if (c) { const l = document.createElement('a'); l.download = `JYUKO_fabric_${state.weaveId}.png`; l.href = c.toDataURL('image/png'); l.click(); } };
window.toggleCompare = () => { if (!state.compareMode) { setState({ compareMode: true, savedConfig: { ...state } }); } else { setState({ compareMode: false, savedConfig: null }); } };
window.applyRandom = () => setState(randomGenerate());
window.applyTrendColor = hex => { setState({ warpColors: [state.warpColors[0] || '#1d3557', hex], modal: null }); };

// åˆæœŸæç”»
render();
</script>
</body>
</html>
